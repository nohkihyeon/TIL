# 트랜잭션 

- 트랜잭션
    - 여러 과정을 하나의 행위로 묶을 때 사용
    - 여러 단계를 수행했을 때, 하나라도 실패하면 모두 취소
- Spring에서 사용하는 어노테이션 `@Transactional`은 해당 메서드를 하나의 트랜잭션 안에서 진행할 수 있도록 만들어주는 역할
- 트랜잭션의 전파 설정 : 진행되고 있는 트랜잭션에서 다른 트랜잭션이 호출될 때 어떻게 처리할지 정하는 것
    

    
    ## 전파 설정 옵션
    
    ### REQUIRED (default)
    
    - 부모 트랜잭션이 존재한다면 부모 트랜잭션으로 합류
    - 부모 트랜잭션이 없다면 새로운 트랜잭션을 생성
    - Spring은 내부적으로 트랜잭션 정보를 ThreadLocal 변수에 저장하기 때문에 다른 쓰레드로 트랜잭션이 전파되지 않음
    - 중간에 롤백 발생 시 모두 하나의 트랜잭션이기 때문에 진행사항이 모두 롤백
        
      
        
    
    ### REQUIRES_NEW
    
    - 무조건 새로운 트랜잭션을 생성
    - 각각의 트랜잭션이 롤백되더라도 서로 영향을 주지 않음
        

        
    
    ### MANDATORY
    
    - 부모 트랜잭션에 합류
    - 만약 부모 트랜잭션이 없다면 예외를 발생
        
    
        
    
    ### NESTED
    
    - 부모 트랜잭션이 존재한다면 중첩 트랜잭션 생성
    - 중첩된 트랜잭션 내부에서 롤백 발생시 해당 중첩 트랜잭션의 시작 지점 까지만 롤백
    - 중첩 트랜잭션은 부모 트랜잭션이 커밋될 때 같이 커밋
        
 
    
    ### NEVER
    
    - 트랜잭션을 생성하지 않는다.
    - 부모 트랜잭션 존재 시 예외 발생
        
 
        
    
    ### SUPPORTS
    
    - 부모 트랜잭션이 있다면 합류
    - 부모 트랜잭션이 없다면 트랜잭션을 생성하지 않음
    
    ### NOT SUPPORTED
    
    - 부모 트랜잭션이 있다면 보류
    - 진행중인 부모 트랜잭션이 없다면 트랜잭션을 생성하지 않음
    
    ### 트랜잭션 롤백 예외 : rollbackFor
    
    - 선언적 트랜잭션에서는 런타임 예외가 발생했을 때만 롤백
    - 일반적으로 체크 예외는 리턴 값 대신 비즈니스적인 의미를 담아 던지는 예외
    - 비즈니스 예외는 개발자에게 복구를 맡기고 프로그램적으로 문제가 있는 런타임시에만 롤백
    
    ```java
    @Transactional(rollbackFor = DataNotFoundException.class)
    ```
    
    > 참고
    > 
    
    [[Spring] 트랜잭션의 전파 설정별 동작](https://deveric.tistory.com/86)
